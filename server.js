import express from "express";
import fetch from "node-fetch";

const app = express();
const PORT = process.env.PORT || 3000;

// sua chave da OpenWeatherMap
const API_KEY = "b4287a5c1971d7dc0de18a7304721da7";

// lista completa das cidades da ParaÃ­ba com IDs
const cidadesPB = [
    {nome: "Ãgua Branca", id: 3407961},
    {nome: "Aguiar", id: 3407965},
    {nome: "Alagoa Grande", id: 3408096},
    {nome: "Alagoa Nova", id: 3408097},
    {nome: "Alagoinha", id: 3408103},
    {nome: "Alcantil", id: 3408121},
    {nome: "AlgodÃ£o de JandaÃ­ra", id: 3408138},
    {nome: "Alhandra", id: 3408166},
    {nome: "Amparo", id: 3407616},
    {nome: "Aparecida", id: 3407385},
    {nome: "AraÃ§agi", id: 3407360},
    {nome: "Arara", id: 3407346},
    {nome: "Araruna", id: 3407344},
    {nome: "Areia", id: 3407216},
    {nome: "Areia de BaraÃºnas", id: 3407214},
    {nome: "Areial", id: 3407212},
    {nome: "Aroeiras", id: 3407069},
    {nome: "AssunÃ§Ã£o", id: 3407028},
    {nome: "BaÃ­a da TraiÃ§Ã£o", id: 3406924},
    {nome: "Bananeiras", id: 3406496},
    {nome: "BaraÃºna", id: 3406441},
    {nome: "Barra de Santa Rosa", id: 3406409},
    {nome: "Barra de Santana", id: 3406408},
    {nome: "Barra de SÃ£o Miguel", id: 3406407},
    {nome: "Bayeux", id: 3407982},
    {nome: "BelÃ©m", id: 3405930},
    {nome: "BelÃ©m do Brejo do Cruz", id: 3405929},
    {nome: "Bernardino Batista", id: 3405914},
    {nome: "Boa Ventura", id: 3405747},
    {nome: "Boa Vista", id: 3405733},
    {nome: "Bom Jesus", id: 3405661},
    {nome: "Bom Sucesso", id: 3405641},
    {nome: "Bonito de Santa FÃ©", id: 3405631},
    {nome: "BoqueirÃ£o", id: 3405608},
    {nome: "Borborema", id: 3405585},
    {nome: "Brejo do Cruz", id: 3405456},
    {nome: "Brejo dos Santos", id: 3405455},
    {nome: "CaaporÃ£", id: 3404594},
    {nome: "Cabaceiras", id: 3404578},
    {nome: "Cabedelo", id: 3404558},
    {nome: "Cachoeira dos Ãndios", id: 3404508},
    {nome: "Cacimba de Areia", id: 3404497},
    {nome: "Cacimba de Dentro", id: 3404496},
    {nome: "Cacimbas", id: 3404495},
    {nome: "CaiÃ§ara", id: 3404414},
    {nome: "Cajazeiras", id: 3404115},
    {nome: "Cajazeirinhas", id: 3404114},
    {nome: "Caldas BrandÃ£o", id: 3403923},
    {nome: "CamalaÃº", id: 3403878},
    {nome: "Campina Grande", id: 3403642},
    {nome: "Capim", id: 3403254},
    {nome: "CaraÃºbas", id: 3403150},
    {nome: "Carrapateira", id: 3403099},
    {nome: "Casserengue", id: 3402684},
    {nome: "Catingueira", id: 3402663},
    {nome: "CatolÃ© do Rocha", id: 3402381},
    {nome: "CaturitÃ©", id: 3402369},
    {nome: "ConceiÃ§Ã£o", id: 3401843},
    {nome: "Condado", id: 3401831},
    {nome: "Conde", id: 3401828},
    {nome: "Congo", id: 3401813},
    {nome: "Coremas", id: 3401734},
    {nome: "Coxixola", id: 3401562},
    {nome: "Cruz do EspÃ­rito Santo", id: 3401439},
    {nome: "Cubati", id: 3401406},
    {nome: "CuitÃ©", id: 3401384},
    {nome: "CuitÃ© de Mamanguape", id: 3401383},
    {nome: "Cuitegi", id: 3401382},
    {nome: "Curral de Cima", id: 3401353},
    {nome: "Curral Velho", id: 3401352},
    {nome: "DamiÃ£o", id: 3401267},
    {nome: "Desterro", id: 3401093},
    {nome: "Diamante", id: 3401075},
    {nome: "Dona InÃªs", id: 3400933},
    {nome: "Duas Estradas", id: 3400907},
    {nome: "Emas", id: 3400775},
    {nome: "EsperanÃ§a", id: 3400736},
    {nome: "Fagundes", id: 3400569},
    {nome: "Frei Martinho", id: 3400308},
    {nome: "Gado Bravo", id: 3399769},
    {nome: "Guarabira", id: 3398570},
    {nome: "GurinhÃ©m", id: 3398459},
    {nome: "GurjÃ£o", id: 3398458},
    {nome: "Ibiara", id: 3398379},
    {nome: "Igaracy", id: 3398309},
    {nome: "Imaculada", id: 3398268},
    {nome: "IngÃ¡", id: 3398240},
    {nome: "Itabaiana", id: 3398076},
    {nome: "Itaporanga", id: 3397939},
    {nome: "Itapororoca", id: 3397938},
    {nome: "Itatuba", id: 3397891},
    {nome: "JacaraÃº", id: 3397780},
    {nome: "JericÃ³", id: 3397541},
    {nome: "JoÃ£o Pessoa", id: 3397277},
    {nome: "Juarez TÃ¡vora", id: 3397154},
    {nome: "Juazeirinho", id: 3397153},
    {nome: "Junco do SeridÃ³", id: 3397138},
    {nome: "Juripiranga", id: 3397127},
    {nome: "Juru", id: 3397124},
    {nome: "Lagoa", id: 3396960},
    {nome: "Lagoa de Dentro", id: 3396946},
    {nome: "Lagoa Seca", id: 3396929},
    {nome: "Lastro", id: 3396636},
    {nome: "Livramento", id: 3396368},
    {nome: "Logradouro", id: 3396332},
    {nome: "Lucena", id: 3396283},
    {nome: "MÃ£e d'Ãgua", id: 3395981},
    {nome: "Malta", id: 3395875},
    {nome: "Mamanguape", id: 3395713},
    {nome: "ManaÃ­ra", id: 3395696},
    {nome: "MarcaÃ§Ã£o", id: 3395525},
    {nome: "Mari", id: 3395478},
    {nome: "MarizÃ³polis", id: 3395469},
    {nome: "Massaranduba", id: 3395338},
    {nome: "Mataraca", id: 3395316},
    {nome: "Matinhas", id: 3395300},
    {nome: "Mato Grosso", id: 3395297},
    {nome: "MaturÃ©ia", id: 3395283},
    {nome: "Mogeiro", id: 3394617},
    {nome: "Montadas", id: 3394562},
    {nome: "Monte Horebe", id: 3394549},
    {nome: "Monteiro", id: 3394548},
    {nome: "Mulungu", id: 3394405},
    {nome: "Natuba", id: 3394024},
    {nome: "Nazarezinho", id: 3394013},
    {nome: "Nova Floresta", id: 3393832},
    {nome: "Nova Olinda", id: 3393809},
    {nome: "Nova Palmeira", id: 3393806},
    {nome: "Olho d'Ãgua", id: 3393624},
    {nome: "Olivedos", id: 3393617},
    {nome: "Ouro Velho", id: 3393437},
    {nome: "Parari", id: 3393028},
    {nome: "Passagem", id: 3392958},
    {nome: "Patos", id: 3392929},
    {nome: "Paulista", id: 3392854},
    {nome: "Pedra Branca", id: 3392649},
    {nome: "Pedra Lavrada", id: 3392643},
    {nome: "Pedras de Fogo", id: 3392638},
    {nome: "Pedro RÃ©gis", id: 3392630},
    {nome: "PiancÃ³", id: 3392424},
    {nome: "PicuÃ­", id: 3392401},
    {nome: "Pilar", id: 3392379},
    {nome: "PilÃµes", id: 3392375},
    {nome: "PilÃµezinhos", id: 3392374},
    {nome: "Pirpirituba", id: 3392296},
    {nome: "Pitimbu", id: 3392268},
    {nome: "Pocinhos", id: 3392242},
    {nome: "PoÃ§o Dantas", id: 3392239},
    {nome: "PoÃ§o de JosÃ© de Moura", id: 3392238},
    {nome: "Pombal", id: 3392191},
    {nome: "Prata", id: 3392056},
    {nome: "Princesa Isabel", id: 3392049},
    {nome: "PuxinanÃ£", id: 3391861},
    {nome: "Queimadas", id: 3391791},
    {nome: "QuixabÃ¡", id: 3391758},
    {nome: "RemÃ­gio", id: 3390770},
    {nome: "RiachÃ£o", id: 3390678},
    {nome: "RiachÃ£o do Bacamarte", id: 3390677},
    {nome: "RiachÃ£o do PoÃ§o", id: 3390676},
    {nome: "Riacho de Santo AntÃ´nio", id: 3390662},
    {nome: "Riacho dos Cavalos", id: 3390661},
    {nome: "Rio Tinto", id: 3390160},
    {nome: "Salgadinho", id: 3389779},
    {nome: "Salgado de SÃ£o FÃ©lix", id: 3389778},
    {nome: "Santa CecÃ­lia", id: 3389557},
    {nome: "Santa Cruz", id: 3389542},
    {nome: "Santa Helena", id: 3389506},
    {nome: "Santa InÃªs", id: 3389493},
    {nome: "Santa Luzia", id: 3389461},
    {nome: "Santa Rita", id: 3389321},
    {nome: "Santa Teresinha", id: 3389312},
    {nome: "Santana de Mangueira", id: 3389356},
    {nome: "Santana dos Garrotes", id: 3389355},
    {nome: "Santo AndrÃ©", id: 3389292},
    {nome: "SÃ£o Bentinho", id: 3388992},
    {nome: "SÃ£o Bento", id: 3388991},
    {nome: "SÃ£o Domingos", id: 3388932},
    {nome: "SÃ£o Domingos do Cariri", id: 3388931},
    {nome: "SÃ£o Francisco", id: 3388874},
    {nome: "SÃ£o JoÃ£o do Cariri", id: 3388762},
    {nome: "SÃ£o JoÃ£o do Rio do Peixe", id: 3388760},
    {nome: "SÃ£o JoÃ£o do Tigre", id: 3388759},
    {nome: "SÃ£o JosÃ© da Lagoa Tapada", id: 3388687},
    {nome: "SÃ£o JosÃ© de Caiana", id: 3388685},
    {nome: "SÃ£o JosÃ© de Espinharas", id: 3388684},
    {nome: "SÃ£o JosÃ© de Piranhas", id: 3388683},
    {nome: "SÃ£o JosÃ© de Princesa", id: 3388682},
    {nome: "SÃ£o JosÃ© do Bonfim", id: 3388680},
    {nome: "SÃ£o JosÃ© do Brejo do Cruz", id: 3388679},
    {nome: "SÃ£o JosÃ© do Sabugi", id: 3388678},
    {nome: "SÃ£o JosÃ© dos Cordeiros", id: 3388677},
    {nome: "SÃ£o JosÃ© dos Ramos", id: 3388676},
    {nome: "SÃ£o Mamede", id: 3388665},
    {nome: "SÃ£o Miguel de Taipu", id: 3388645},
    {nome: "SÃ£o SebastiÃ£o de Lagoa de RoÃ§a", id: 3388618},
    {nome: "SÃ£o SebastiÃ£o do Umbuzeiro", id: 3388617},
    {nome: "SapÃ©", id: 3388582},
    {nome: "SeridÃ³", id: 3387858},
    {nome: "Serra Branca", id: 3387841},
    {nome: "Serra da Raiz", id: 3387838},
    {nome: "Serra Grande", id: 3387833},
    {nome: "Serra Redonda", id: 3387828},
    {nome: "Serraria", id: 3387825},
    {nome: "SertÃ£ozinho", id: 3387816},
    {nome: "Sobrado", id: 3387647},
    {nome: "SolÃ¢nea", id: 3387607},
    {nome: "Soledade", id: 3387606},
    {nome: "SossÃªgo", id: 3387598},
    {nome: "Sousa", id: 3387246},
    {nome: "SumÃ©", id: 3387147},
    {nome: "TaperoÃ¡", id: 3386687},
    {nome: "Tavares", id: 3386662},
    {nome: "Teixeira", id: 3386637},
    {nome: "TenÃ³rio", id: 3386623},
    {nome: "Triunfo", id: 3386016},
    {nome: "UiraÃºna", id: 3385860},
    {nome: "Umbuzeiro", id: 3385852},
    {nome: "VÃ¡rzea", id: 3385356},
    {nome: "VieirÃ³polis", id: 3385076},
    {nome: "Vista Serrana", id: 3385029},
    {nome: "ZabelÃª", id: 3384964}
];

// rota principal
app.get("/", (req, res) => {
  res.send("ðŸŒ¤ï¸ API Clima ParaÃ­ba - acesse /clima para ver os dados em tempo real.");
});

// rota para buscar temperatura de todas as cidades
app.get("/clima", async (req, res) => {
  try {
    const resultados = await Promise.all(
      cidadesPB.map(async (cidade) => {
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?id=${cidade.id}&appid=${API_KEY}&units=metric&lang=pt_br`
        );
        const data = await response.json();

        return {
          cidade: cidade.nome,
          temperatura: data.main?.temp ?? "N/A",
          condicao: data.weather?.[0]?.description ?? "N/A",
          hora_local: new Date(data.dt * 1000).toLocaleString("pt-BR")
        };
      })
    );

    res.json({ clima: resultados });
  } catch (error) {
    res.status(500).json({ erro: "Erro ao buscar dados da API", detalhes: error.message });
  }
});

// inicia o servidor
app.listen(PORT, () => {
  console.log(`Servidor rodando na porta ${PORT}`);
});
